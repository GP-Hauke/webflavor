function initCommonFunctions(){$("body").keydown(function(event){39==event.which?window.parent.nextPage():37==event.which&&window.parent.prevPage()})}function openGlossary(){$("#glossaryModal").on("shown.bs.modal",function(e){$("#glossaryModal .modal-body").css({height:$("#glossaryModal").height()})}),$("#glossaryModal").modal()}function initContent(pageID){var courseData=JSON.parse(localStorage.getItem(window.parent.LOCAL_COURSE_DATA_ID));updatePagination(),"true"==courseData.COUNT_PAGES&&registerPageVisit(window.parent.LOCAL_COURSE_DATA_ID,pageID),void 0!==courseData.cardData&&populateCards();try{$("#pageTitle").html(window.parent.getPageTitle())}catch(e){console.log("something went wrong ",e)}$(".footer-spacer").length&&$(".footer-spacer").css({height:window.parent.getFooterHeight()+25});try{window.parent.pageLoaded()}catch(e){console.log("something went wrong ",e)}}function updatePagination(){var currChap=window.parent.currentChapter+1;$(".page-number").empty(),$(".page-number").append("<span>"+currChap+"</span> of <span>1</span>")}function populateCards(){var courseData=JSON.parse(localStorage.getItem(window.parent.LOCAL_COURSE_DATA_ID)),cardsOnPage=$('div[id*="card"]');if(1<=cardsOnPage.length){for(var refreshTimer=setTimeout(function(){location.reload()},1e4),cardNums=[],i=0;i<cardsOnPage.length;i++)cardNums.push(parseInt(cardsOnPage[i].id.substring(4,6),10));var minNum=Math.min.apply(Math,cardNums);for(i=minNum;i<cardsOnPage.length+minNum;i++){var dataIndex=i-1,card=$("#card"+i);card.TYPE=courseData.cardData.cardContent[dataIndex].TYPE,"popup"===card.TYPE?("false"===courseData.cardData.cardContent[dataIndex].actions[0].executed?card.append("<div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div>"):card.append("<div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div><div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>"),card.click(function(){0===$(this).has(".viewed-overlay").length&&$(this).append("<div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>");var clickDataIndex=parseInt($(this).attr("id").substring(4,6),10)-1,heading=courseData.cardData.cardContent[clickDataIndex].cardHeading,content=courseData.cardData.cardContent[clickDataIndex].popupContent;courseData.cardData.cardContent[clickDataIndex].actions[0].executed="true",localStorage.setItem(window.parent.LOCAL_COURSE_DATA_ID,JSON.stringify(courseData)),window.parent.openContentModal(heading,content)})):"text"===card.TYPE?("false"===courseData.cardData.cardContent[dataIndex].actions[0].executed?card.append("<div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div>"):card.append("<div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div><div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>"),card.click(function(){0===$(this).has(".viewed-overlay").length&&$(this).append("<div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>");var clickDataIndex=parseInt($(this).attr("id").substring(4,6),10)-1,heading=courseData.cardData.cardContent[clickDataIndex].cardHeading,content=courseData.cardData.cardContent[clickDataIndex].popupContent,img=courseData.cardData.cardContent[clickDataIndex].imgStr;courseData.cardData.cardContent[clickDataIndex].actions[0].executed="true",localStorage.setItem(window.parent.LOCAL_COURSE_DATA_ID,JSON.stringify(courseData)),openPageModal(heading,content,img)})):"links"===card.TYPE?("false"===courseData.cardData.cardContent[dataIndex].actions[0].executed?card.append("<a href='' alt='' target='_blank'><div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div></a>"):card.append("<a href='' alt='' target='_blank'><div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div><div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div></a>"),card.find("a").attr("href",courseData.cardData.cardContent[dataIndex].actions[0].urlstr),card.find("a").attr("alt",courseData.cardData.cardContent[dataIndex].cardHeading),card.click(function(){0===$(this).has(".viewed-overlay").length&&$(this).append("<div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>");var clickDataIndex=parseInt($(this).attr("id").substring(4,6),10)-1;courseData.cardData.cardContent[clickDataIndex].actions[0].executed="true",localStorage.setItem(window.parent.LOCAL_COURSE_DATA_ID,JSON.stringify(courseData))})):"video"===card.TYPE?("false"===courseData.cardData.cardContent[dataIndex].actions[0].executed?card.append("<div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div>"):card.append("<div class='loading-overlay'><p>Loading...</p></div><div class='img-container'><img class='img-zoom card-img' src='' alt=''></div><div class='caption'><h3></h3><p></p></div><div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>"),card.click(function(){0===$(this).has(".viewed-overlay").length&&$(this).append("<div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'/></div>");var clickDataIndex=parseInt($(this).attr("id").substring(4,6),10)-1,heading=courseData.cardData.cardContent[clickDataIndex].cardHeading,vidSrc=courseData.cardData.cardContent[clickDataIndex].vidSrc,posterSrc=courseData.cardData.cardContent[clickDataIndex].posterSrc;courseData.cardData.cardContent[clickDataIndex].actions[0].executed="true",localStorage.setItem(window.parent.LOCAL_COURSE_DATA_ID,JSON.stringify(courseData)),window.parent.openVidModal(heading,vidSrc,posterSrc)})):"plain"===card.TYPE||"page-content"===card.TYPE&&card.append("<div class='img-container'><img class='img-zoom card-img' src='' alt=''></div>"),card.find(".caption p").html(courseData.cardData.cardContent[dataIndex].blurb),card.find(".caption h3").text(courseData.cardData.cardContent[dataIndex].cardHeading);var imgTag=card.find("img.card-img");imgTag.attr("src",courseData.cardData.cardContent[dataIndex].imgStr),imgTag.attr("alt",courseData.cardData.cardContent[dataIndex].cardHeading),$("#card"+i+" .loading-overlay").fadeOut("fast")}clearTimeout(refreshTimer)}}function removeDupes(a){for(var seen={},out=[],len=a.length,j=0,i=0;i<len;i++){var item=a[i];1!==seen[item]&&(seen[item]=1,out[j++]=item)}return out}function tallyActions(){for(var courseData=JSON.parse(localStorage.getItem(window.parent.LOCAL_COURSE_DATA_ID)),displayCompleteBtn=!1,executedActions=[],requiredActions=[],requiredExecutedActions=[],requiredNotExecutedActions=[],i=0;i<courseData.assessmentData.assessments.length;i++)"true"===courseData.assessmentData.assessments[i].completed&&requiredExecutedActions.push(courseData.assessmentData.assessments[i].title);for(i=0;i<courseData.assessmentData.assessments.length;i++)"false"===courseData.assessmentData.assessments[i].completed&&requiredNotExecutedActions.push(courseData.assessmentData.assessments[i].title);requiredNotExecutedActions=removeDupes(requiredNotExecutedActions);for(i=0;i<requiredExecutedActions.length;i++)for(var j=requiredNotExecutedActions.length-1;0<=j;j--)requiredExecutedActions[i]===requiredNotExecutedActions[j]&&requiredNotExecutedActions.splice(j,1);for(i=0;i<courseData.cardData.cardContent.length;i++)for(j=0;j<courseData.cardData.cardContent[i].actions.length;j++){var cardActionExecuted=courseData.cardData.cardContent[i].actions[j].executed,cardActionRequired=courseData.cardData.cardContent[i].actions[j].required;"true"===cardActionExecuted&&executedActions.push(courseData.cardData.cardContent[i].actions[j]),"true"===cardActionRequired&&requiredActions.push(courseData.cardData.cardContent[i].actions[j]),"true"===cardActionExecuted&&"true"===cardActionRequired&&requiredExecutedActions.push(courseData.cardData.cardContent[i].actions[j].label),"false"===cardActionExecuted&&"true"===cardActionRequired&&requiredNotExecutedActions.push(courseData.cardData.cardContent[i].actions[j].label)}if(4===requiredExecutedActions.length){displayCompleteBtn=!0;var msg="";switch(executedActions.length){case 0:case 1:case 2:case 3:case 4:msg="Great Job! You completed the required elements but there are other topics that may help you with your customers. Consider reviewing those pieces before you go.";break;case 5:case 6:case 7:case 8:msg="Pretty good! You've completed some of the elements for the Connected Vehicle Services but there are other pieces that can help you better serve your customers. You may want to take the time to go back and review them before exiting the course.";break;case 9:case 10:case 11:msg="Great job! You've completed most of the elements required for the course. You may want to consider going back and reviewing some of the elements you may have missed.";break;case 12:case 13:case 14:case 15:default:msg="Well done! You've completed all the required elements for the course!"}$("#completionBox").append("<p>"+msg+"</p>")}else{var list="";for(i=0;i<requiredNotExecutedActions.length;i++)list=list+"<li>"+requiredNotExecutedActions[i]+"</li>";$("#completionBox").append("<p>Not quite. You haven't completed your requirements yet. Please go back and review the required elements before exiting the course or you will not receive credit for this course. Remember, the required elements include:</p><ul>"+list+"</ul>")}!0===displayCompleteBtn&&$("#completionBox").append('<div class="row"><div class="col-sm-offset-2 col-sm-8"><a class="btn btn-default center-block btn-complete" id="btnComplete" role="button" onclick="setComplete()">Click Here for Credit</a></div></div>')}function setupAssessment(){setTimeout(function(){var courseData=JSON.parse(localStorage.getItem(window.parent.LOCAL_COURSE_DATA_ID)),assessmentID=parseInt($(".btn-assess").attr("id").substring(13,15),10)-1;if(0===assessmentID)for(var i=0;i<3;i++)"true"!==courseData.assessmentData.assessments[i].completed||$(".btn-assess").append("<div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'></div>");else 3===assessmentID&&"true"===courseData.assessmentData.assessments[assessmentID].completed&&$(".btn-assess").append("<div class='viewed-overlay'><img src='../"+courseData.THEME_PATH+"/media/img/icon_viewed.png'></div>");$(".btn-assess").click(function(){window.parent.openModal("assessment",assessmentID,$(this))})},1)}function setComplete(){window.parent.SetComplete(),$("#btnComplete").hide();$("#sectionComplete").text("Thank you for completing this course. Your training record will be updated.")}function disableSwiping(){$(window).off("swipeleft"),$(window).off("swiperight")}function changeVolume(args){$("video").prop("volume",args),$("audio").prop("volume",args)}function openPageModal(heading,content,img){var courseData=JSON.parse(localStorage.getItem(window.parent.LOCAL_COURSE_DATA_ID));$("#pageModalContainer").html('<div class="modal fade" id="pageModal" tabindex="-1" role="dialog" aria-labelledby="pageModalLabel" style="background:url('+img+') center bottom / cover no-repeat fixed"><div class="container"><div class="row"><div class="modal-dialog" role="document"><div class="modal-page text-container col-md-8"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><img src="../'+courseData.THEME_PATH+'/media/img/btn_close.png" alt="close the modal"></span></button><h4 class="modal-title" id="">'+heading+'</h4></div><div class="modal-body clearfix">'+content+"</div></div></div></div></div></div>"),$(".modal").on("hidden.bs.modal",function(e){$("#pageModalContainer").html("")}),$(".modal").modal()}function onAssessmentDone(param1,param2){alert(param1+param2)}function loadContent(param){var arg="../../../dir/content/course_content/"+param+".xml";$.get(arg).done(function(xml){$("#pageContent").append($(xml).find("content").text())})}var Signal,courseData,totalPages,activePageCount,currentChapter,currentPage,resources,LOCAL_COURSE_DATA_ID,settingsLoaded=!1,glossaryLoaded=!1,resourcesLoaded=!1,navigationLoaded=!1,cardContentLoaded=!1,stringsLoaded=!1,assessmentsLoaded=!1,pageIsLoading=!1,strings=[],cookieName="cookieName",muted=!1,volume=.6;function initInterface(){localStorage.clear(),$(window).resize(function(){calculateHeight()}),$(window).on("unload",function(){QuitLMS()}),StartLMS(),loadXMLData()}function loadXMLData(){!1!==settingsLoaded?"true"!==(courseData=JSON.parse(localStorage.getItem(LOCAL_COURSE_DATA_ID))).HAS_RESOURCES||!1!==resourcesLoaded?"none"===courseData.MENU_PLACEMENT||!1!==navigationLoaded?void 0===courseData.cardData||!1!==cardContentLoaded?void 0===courseData.assessmentData||!1!==assessmentsLoaded?"true"!==courseData.HAS_GLOSSARY||!1!==glossaryLoaded?checkXMLLoadingComplete():GetInterfaceXML("../../dir/content/glossary.xml"):GetInterfaceXML("../../dir/content/assessments.xml"):GetInterfaceXML("../../dir/content/card_content.xml"):GetInterfaceXML("../../dir/content/navigation.xml"):GetInterfaceXML("../../dir/content/course_resources.xml"):GetInterfaceXML("../../dir/content/settings.xml")}function GetInterfaceXML(args){$.get(args).done(function(xml){-1!=args.indexOf("settings")?(settingsLoaded=!0,initSettings(xml),loadXMLData()):-1!=args.indexOf("course_resources")?(resourcesLoaded=!0,buildReources(xml),loadXMLData()):-1!=args.indexOf("navigation")?(navigationLoaded=!0,addNavToLocalStorage(xml),buildInterface(),loadXMLData()):-1!=args.indexOf("card_content")?(cardContentLoaded=!0,initCardContent(xml),loadXMLData()):-1!=args.indexOf("assessments")?(assessmentsLoaded=!0,initAssessments(xml),loadXMLData()):-1!=args.indexOf("strings")?(stringsLoaded=!0,buildStrings(xml)):-1!=args.indexOf("glossary")&&(glossaryLoaded=!0,addGlossaryToLocalStorage(xml),loadXMLData())})}function buildInterface(){document.title=courseData.TITLE,cookieName=courseData.COOKIE_NAME,currentPage=currentChapter=totalPages=0,buildShellUI(),"true"===courseData.COUNT_PAGES&&(courseData.pageCount.pagesTotal=totalPages,localStorage.setItem(LOCAL_COURSE_DATA_ID,JSON.stringify(courseData)))}function buildShellUI(){"top"===courseData.MENU_PLACEMENT?buildTopNav():"left"===courseData.MENU_PLACEMENT?buildLeftNav():buildNoneNav()}function buildReources(xml){resources=new Glossary(xml)}function buildStrings(xml){for(var i=0;i<xml.getElementsByTagName("string").length;i++)strings.push(xml.getElementsByTagName("string")[i].childNodes[0].nodeValue);checkXMLLoadingComplete()}function checkXMLLoadingComplete(){if(null!==courseData.chapters){if("true"==courseData.HAS_LOCAL_BOOKMARKING){var goToPage=courseData.localBookmarkingStorage;currentChapter=goToPage.chapter,currentPage=goToPage.page}else{var bm=GetBookmark();bm&&""!=bm&&bm.indexOf("_")&&(isNaN(parseInt(bm.split("_")[0],10))||(currentChapter=parseInt(bm.split("_")[0],10)),isNaN(parseInt(bm.split("_")[1],10))||(currentPage=parseInt(bm.split("_")[1],10)))}loadPage(),enforcedShow($("#mainContainer")),"true"===courseData.HAS_SPLASH_PAGE&&0===currentChapter&&0===currentPage&&openModal("splashPage"),"true"===courseData.HAS_GLOSSARY&&$("#btnGlossary").click(function(){openModal("glossary")}),$("#btnHelpModal").click(function(){openModal("help")}),$("#mainContainer").css("opacity",1),$("body").css("opacity",1),$("body").focus()}}function enforcedShow(elem){elem.show(),elem.hasClass("hidden")&&elem.removeClass("hidden")}function resumeYes(){$("#resumeFrame").hide(),""!=courseData.chapters[currentChapter].pages[currentPage].audio?($("#audioBar").show(),startAudio(courseData.chapters[currentChapter].pages[currentPage].audio)):$("#audioBar").hide()}function resumeNo(){$("#resumeFrame").hide(),openPage(0,0)}function buildTopNav(){var navMarkup="";$.get("src/components/navigation/nav.html",function(data){navMarkup=data,$("#navContainer").append(navMarkup),$("#titleMain").html(courseData.TITLE+":"),$("#titleMainMobile").html(courseData.TITLE),$("#subTitle").html(courseData.SUB_TITLE),$("#subTitleMobile").html(courseData.SUB_TITLE);for(var mobileNav="",i=0;i<courseData.chapters.length;i++){var mobileMenuButton="";if(1<courseData.chapters[i].pages.length){mobileMenuButton='<li><button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse'+i+'" aria-expanded="false" aria-controls="collapseExample">'+courseData.chapters[i].title+'</button><div class="collapse" id="collapse'+i+'"><ul class="">';for(var j=0;j<courseData.chapters[i].pages.length;j++)mobileMenuButton=mobileMenuButton+'<li><a href="javascript:openPage('+i+","+j+')">'+courseData.chapters[i].pages[j].title+"</a></li>";mobileMenuButton+="</ul></div></li>"}else mobileMenuButton='<li class="courseTitleChapter" id="courseTitleChapter'+i+'" onclick="openPage('+i+',0)">'+courseData.chapters[i].title+"</li>";mobileNav+=mobileMenuButton}if($("#navbarMobile").append(mobileNav),"true"===courseData.headerLinks.included){var headerLinks="";for(i=0;i<courseData.headerLinks.links.length;i++){headerLinks+='<li><a id="'+courseData.headerLinks.links[i].id+'" href="'+courseData.headerLinks.links[i].href+'" target="'+courseData.headerLinks.links[i].target+'">'+courseData.headerLinks.links[i].title+"</a></li>"}$("#headerLinks").append(headerLinks)}var bottomNav='<div class="container"><div id="navbarBottomCollapse" class="navbar-collapse collapse"><ul id="nav-items-bottom-row" class="nav nav-justified">';for(i=0;i<courseData.chapters.length;i++){var menuButton="";if(1<courseData.chapters[i].pages.length){menuButton='<li class="dropdown"><button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">'+courseData.chapters[i].title+'<span class="caret"></span></button><ul class="dropdown-menu">';for(var k=0;k<courseData.chapters[i].pages.length;k++)menuButton=menuButton+'<li><a href="javascript:openPage('+i+","+k+')">'+courseData.chapters[i].pages[k].title+"</a></li>";menuButton+="</ul></li>"}else menuButton='<li class="courseTitleChapter" id="courseTitleChapter'+i+'" onclick="openPage('+i+',0)">'+courseData.chapters[i].title+"</li>";bottomNav+=menuButton}bottomNav+="</ul></div></div>",$("#navbarMain").on("hidden.bs.collapse",function(){calculateHeight()}),$("#navbarBottom").append(bottomNav),loadInterfaceStyles()})}function buildLeftNav(){var navMarkup="";$.get("src/components/navigation/navLeft.html",function(data){if(navMarkup=data,$("#navContainer").append(navMarkup),$("#titleMain").html(courseData.TITLE+":"),$("#titleMainMobile").html(courseData.TITLE),$("#subTitle").html(courseData.SUB_TITLE),$("#subTitleMobile").html(courseData.SUB_TITLE),$("#contentFrame").css("width","87.5%"),"true"===courseData.headerLinks.included){for(var headerLinks="",i=0;i<courseData.headerLinks.links.length;i++){headerLinks+='<li><a id="'+courseData.headerLinks.links[i].id+'" href="'+courseData.headerLinks.links[i].href+'" target="'+courseData.headerLinks.links[i].target+'">'+courseData.headerLinks.links[i].title+"</a></li>"}$("#headerLinks").append(headerLinks)}var mobileNav="";for(i=0;i<courseData.chapters.length;i++){var mobileMenuButton="";if(1<courseData.chapters[i].pages.length){mobileMenuButton='<li><button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse'+i+'" aria-expanded="false" aria-controls="collapseExample">'+courseData.chapters[i].title+'</button><div class="collapse" id="collapse'+i+'"><ul class="">';for(var j=0;j<courseData.chapters[i].pages.length;j++)mobileMenuButton=mobileMenuButton+'<li><a href="javascript:openPage('+i+","+j+')">'+courseData.chapters[i].pages[j].title+"</a></li>";mobileMenuButton+="</ul></div></li>"}else mobileMenuButton='<li class="courseTitleChapter" id="courseTitleChapter'+i+'" onclick="openPage('+i+',0)">'+courseData.chapters[i].title+"</li>";mobileNav+=mobileMenuButton}$("#navbarMobile").append(mobileNav),$("#navbarMain").on("hidden.bs.collapse",function(){calculateHeight()}),loadInterfaceStyles()})}function buildNoneNav(){loadInterfaceStyles()}function openPage(c,p){checkLock(c,p)&&(currentChapter=c,currentPage=p,loadPage())}function nextPage(){if(!pageIsLoading&&(pageIsLoading=!0,courseData.chapters[currentChapter].pages[currentPage].count!=activePageCount))if(currentPage+1<courseData.chapters[currentChapter].pages.length){if(!checkLock(currentChapter,currentPage+1))return void(pageIsLoading=!1);currentPage++,courseData.localBookmarkingStorage.page+=1,loadPage()}else{if(!checkLock(currentChapter+1,0))return void(pageIsLoading=!1);for(;currentChapter++,"false"==courseData.chapters[currentChapter].isActive;);selectChapter(currentChapter),currentPage=0,loadPage()}}function prevPage(){if(1!=courseData.chapters[currentChapter].pages[currentPage].count)if(currentPage-1!=-1)currentPage--,loadPage();else{for(;currentChapter--,"false"==courseData.chapters[currentChapter].isActive;);currentPage=courseData.chapters[currentChapter].pages.length-1,loadPage()}}function loadPage(){try{stopAudio(),""!=courseData.chapters[currentChapter].pages[currentPage].audio?($("#audioBar").show(),startAudio(courseData.chapters[currentChapter].pages[currentPage].audio)):$("#audioBar").hide()}catch(e){}openLock(currentChapter,currentPage,0),pageIsLoading=!1,$("body").scrollTop(0),document.getElementById("contentFrame").src="src/components/content/"+courseData.chapters[currentChapter].pages[currentPage].file+".html",$(".footer-nav").html(getFooterNav())}function startAudio(args){document.getElementById("pagePlayer").src="media/audio/"+args,document.getElementById("pagePlayer").load(),document.getElementById("pagePlayer").play(),$("#playBtn").hide(),$("#pauseBtn").show()}function stopAudio(){document.getElementById("pagePlayer").pause(),$("#playBtn").show(),$("#pauseBtn").hide()}function playAudio(){document.getElementById("pagePlayer").play(),$("#playBtn").hide(),$("#pauseBtn").show()}function updateProgressTime(){$("#whiteProgBarAudio").css("width",document.getElementById("pagePlayer").currentTime/document.getElementById("pagePlayer").duration*100+"%")}function openAudioTranscript(){}function pageLoaded(){SetBookmark(currentChapter,currentPage),calculateHeight()}function getFooterNav(){checkLock();var footerNavHTML='<span><img src="../../dir/media/img/btn_play_pause_inactive.png" alt="play/pause button"></span>';return footerNavHTML=currentPage!=courseData.chapters[currentChapter].pages.length-1||currentChapter!=courseData.chapters.length-1?footerNavHTML+'<a class="next" href="#" onclick="nextPage();"><img src="../../dir/media'+"/img/btn_next.png"+'" alt="go to next page"></a>':footerNavHTML+'<a class="next" href="#" onclick="nextPage();"><img src="../../dir/media'+"/img/btn_next_inactive.png"+'" alt="go to next page"></a>',footerNavHTML=0!=currentPage||0!=currentChapter?'<a class="back" href="#" onclick="prevPage();"><img src="../../dir/media'+"/img/btn_back.png"+'" alt="go to previous page"></a>'+footerNavHTML:'<a class="back" href="#" onclick="prevPage();"><img src="../../dir/media/'+"/img/btn_back_inactive.png"+'" alt="go to previous page"></a>'+footerNavHTML}function getPageTitle(){return courseData.chapters[currentChapter].pages[currentPage].title}function updateNavigation(){for(var notSelectedClass="menuItemNotSelected",i=activePageCount=0;i<courseData.chapters.length;i++){"false"==courseData.chapters[i].isActive?$("#chapter"+i).hide():$("#chapter"+i).show();for(var completeCount=0,j=0;j<courseData.chapters[i].pages.length;j++)-1==courseData.chapters[i].pages[j].locks.toString().indexOf("0")?($("#mi"+i+"_"+j).removeClass("menuItemSelected").removeClass("menuItemNotActive").removeClass("menuItemNotSelected").addClass("menuItemVisited"),completeCount++):$("#mi"+i+"_"+j).removeClass("menuItemSelected").removeClass("menuItemNotActive").removeClass("menuItemNotSelected").addClass(notSelectedClass),courseData.chapters[i].pages[j].gated&&-1!=courseData.chapters[i].pages[j].locks.toString().indexOf("0")&&"true"==courseData.chapters[i].isActive&&(notSelectedClass="menuItemNotActive"),"false"!=courseData.chapters[i].isActive&&(activePageCount++,courseData.chapters[i].pages[j].count=activePageCount);completeCount==courseData.chapters[i].pages.length&&$("#chapter"+i).removeClass("chapterIncomplete").addClass("chapterComplete")}$("#mi"+currentChapter+"_"+currentPage).removeClass("menuItemNotSelected").removeClass("menuItemNotActive").removeClass("menuItemVisited").addClass("menuItemSelected"),selectChapter(currentChapter),$("#navbarMobile .courseTitleChapter").removeClass("courseTitleChapterSelected"),$("#navbarMobile #courseTitleChapter"+currentChapter).addClass("courseTitleChapterSelected"),$("#nav-items-bottom-row .courseTitleChapter").removeClass("courseTitleChapterSelected"),$("#nav-items-bottom-row #courseTitleChapter"+currentChapter).addClass("courseTitleChapterSelected"),0==currentPage&&0==currentChapter?($("#prevBtn").hide(),$("#nextBtn").show()):currentChapter==courseData.chapters.length-1&&currentPage==courseData.chapters[currentChapter].pages.length-1?($("#prevBtn").show(),$("#nextBtn").hide()):($("#prevBtn").show(),$("#nextBtn").show()),courseData.chapters[currentChapter].pages[currentPage].gated&&-1!=courseData.chapters[currentChapter].pages[currentPage].locks.toString().indexOf("0")&&$("#nextBtn").hide(),null!==$(".footer-nav")&&$(".footer-nav").html(getFooterNav())}function activateChapter(active,deactive,titleIndex){for(var i=0;i<active.length;i++)courseData.chapters[active[i]].isActive="true";for(var j=0;j<deactive.length;j++)courseData.chapters[deactive[j]].isActive="false";-1!=titleIndex&&(courseData.chapters[active[0]].titleIndex=titleIndex,$("#chapter"+active[0]).html(chapters[active[0]].title.split(";")[titleIndex])),updateNavigation()}function selectChapter(args){for(var i=0;i<courseData.chapters.length;i++)$("#chapter"+i).removeClass("chapterSelected").addClass("chapterNotSelected"),i==args&&$("#chapter"+i).removeClass("chapterNotSelected").addClass("chapterSelected")}function checkLock(chapter,page){for(var i=0;i<=chapter;i++)for(var j=0;j<courseData.chapters[i].pages.length&&(i!=chapter||j!=page);j++)if(courseData.chapters[i].pages[j].gated&&-1!=courseData.chapters[i].pages[j].locks.toString().indexOf("0")&&"true"==courseData.chapters[i].isActive)return!1;return!0}function openLock(chapter,page,lock){lock>=courseData.chapters[chapter].pages[page].locks.length||(courseData.chapters[chapter].pages[page].locks[lock]=1,updateNavigation(),CreatePathmarks())}function changeVolume(args){volume=args/100,$("video").prop("volume",volume),$("audio").prop("volume",volume);try{var el=document.getElementById("contentFrame");el.contentWindow?el.contentWindow.changeVolume(volume):el.contentDocument&&el.contentDocument.changeVolume(volume)}catch(e){}}function muteAudio(){$("#volumeSlider").toggle()}function unmuteAudio(){$("#volumeSlider").toggle()}function calculateHeight(){$("#contentContainer").css({height:$(window).height()-1}),$("#contentFrame").css({height:$("#contentContainer").height()-$("#navbar").height(),top:$("#navbar").height()}),$("#audioBar").width($("#mainContainer").width()-216-$("#navBtns").width())}function closeCourse(){top.window.close()}function getFooterHeight(){return $("footer").height()}function initSettings(xml){LOCAL_COURSE_DATA_ID=$(xml).find("courseStorageID").text();var localStorageSize=(2*JSON.stringify(localStorage).length/1048576).toFixed(4);console.log("localStorage in megabytes: ",localStorageSize);var currentVersion=$(xml).find("version").text(),tempStorage=JSON.parse(localStorage.getItem(LOCAL_COURSE_DATA_ID));null!==tempStorage&&tempStorage.SETTINGS_VERSION===currentVersion||populateStorage(xml,tempStorage)}function populateStorage(xml,tempStorage){var courseStorageObj={};if(courseStorageObj.TITLE=$(xml).find("courseTitle").text(),courseStorageObj.SUB_TITLE=$(xml).find("courseSubTitle").text(),courseStorageObj.SETTINGS_VERSION=$(xml).find("version").text(),courseStorageObj.THEME=$(xml).find("theme").text(),courseStorageObj.THEME_PATH="dir/themes/"+courseStorageObj.THEME,courseStorageObj.COOKIE_NAME=$(xml).find("cookieName").text(),courseStorageObj.MENU_PLACEMENT=$(xml).find("menuPlacement").text(),courseStorageObj.COMPLETION_METHOD=$(xml).find("completionMethod").text(),courseStorageObj.HAS_STRINGS=$(xml).find("hasStrings").text(),courseStorageObj.HAS_GLOSSARY=$(xml).find("hasGlossary").text(),courseStorageObj.HAS_RESOURCES=$(xml).find("hasResources").text(),courseStorageObj.HAS_SPLASH_PAGE=$(xml).find("hasSplashPage").text(),"true"===$(xml).find("hasCards").text()&&(null===tempStorage||void 0===tempStorage.cardData?courseStorageObj.cardData={}:courseStorageObj.cardData=tempStorage.cardData),courseStorageObj.HAS_LOCAL_BOOKMARKING=$(xml).find("hasLocalBookmarking").text(),courseStorageObj.COUNT_PAGES=$(xml).find("countPages").text(),"true"==courseStorageObj.COUNT_PAGES){courseStorageObj.pageCount={pagesTotal:0,pagesVisited:0,pageIds:[]}}"true"===$(xml).find("hasAssessments").text()&&(null===tempStorage||void 0===tempStorage.assessmentData?courseStorageObj.assessmentData={}:courseStorageObj.assessmentData=tempStorage.assessmentData),"true"===$(xml).find("hasGlossary").text()&&(null===tempStorage||void 0===tempStorage.glossary?courseStorageObj.glossary={}:courseStorageObj.glossary=tempStorage.glossary),localStorage.setItem(LOCAL_COURSE_DATA_ID,JSON.stringify(courseStorageObj))}function addGlossaryToLocalStorage(xml){var storage=localStorage.getItem(LOCAL_COURSE_DATA_ID),tempStorage=JSON.parse(storage);tempStorage.glossary={items:[]};for(var itemsXML=$(xml).find("item"),items=[],hl=0;hl<itemsXML.length;hl++)item={},item.term=$(itemsXML[hl]).find("term").text(),item.definition=$(itemsXML[hl]).find("definition").text(),items.push(item);tempStorage.glossary.items=items,localStorage.setItem(LOCAL_COURSE_DATA_ID,JSON.stringify(tempStorage))}function addNavToLocalStorage(xml){var storage=localStorage.getItem(LOCAL_COURSE_DATA_ID),tempStorage=JSON.parse(storage);if("true"==xml.getElementsByTagName("course")[0].getAttribute("useNextPrevLabel")&&(tempStorage.USE_PREV_NEXT_LBL=!0),tempStorage.headerLinks={included:$(xml).find("headerLinks").attr("included"),links:[]},"true"===tempStorage.headerLinks.included){for(var headerlinksXML=$(xml).find("headerLink"),headerLinks=[],hl=0;hl<headerlinksXML.length;hl++)headerlink={},headerlink.title=$(headerlinksXML[hl]).text(),headerlink.href=$(headerlinksXML[hl]).attr("href"),headerlink.id=$(headerlinksXML[hl]).attr("itemId"),headerlink.target=$(headerlinksXML[hl]).attr("target"),headerLinks.push(headerlink);tempStorage.headerLinks.links=headerLinks}var chapters=[],pageCount=0,pm=GetPathmark();pm=pm&&""!=pm&&-1!=pm.indexOf("]")?-1!=pm.indexOf(":")?pm.split(":"):[pm]:"";for(var chapterXML=$(xml).find("chapter"),i=0;i<chapterXML.length;i++){var lpm,chp={};if(chp.title=$(chapterXML[i]).find("title").text(),pm&&""!=pm&&null!=pm[i]){var active="false";"1"==pm[i].split("}")[0].split("]")[0]&&(active="true"),chp.isActive=active,chp.titleIndex=pm[i].split("}")[0].split("]")[1]}else chp.isActive="true",chp.titleIndex=-1;chp.pages=new Array,pm&&""!=pm&&null!=pm[i]&&(lpm=pm[i].split("}")[1].split(";"));for(var pageXML=chapterXML[i].getElementsByTagName("pages")[0].getElementsByTagName("page"),j=0;j<pageXML.length;j++){pageCount++;var pg=new Object;if(pg.title=pageXML[j].childNodes[0].nodeValue,pg.gated="true"==pageXML[j].getAttribute("gated"),pg.audio="",pg.video=!1,pageXML[j].getAttribute("audio")&&(pg.audio=pageXML[j].getAttribute("audio")),pageXML[j].getAttribute("video")&&"true"==pageXML[j].getAttribute("video")&&(pg.video=!0),pg.locks=[0],lpm&&lpm[j]){if(-1!=lpm[j].indexOf(",")){var tpm=lpm[j].split(",");lpm[j]=tpm}else lpm[j]=[lpm[j]];pg.locks[0]=parseInt(lpm[j][0],10)}for(var l=0;l<parseInt(pageXML[j].getAttribute("locks"),10);l++)lpm&&lpm[j][l+1]?pg.locks.push(parseInt(lpm[j][l+1],10)):pg.locks.push(0);pg.file=i+"_"+j,pg.count=pageCount,chp.pages.push(pg)}chapters.push(chp)}tempStorage.chapters=chapters,localStorage.setItem(LOCAL_COURSE_DATA_ID,JSON.stringify(tempStorage))}function loadInterfaceStyles(){var courseData=JSON.parse(localStorage.getItem(LOCAL_COURSE_DATA_ID));$(".add-theme-path").attr("src",function(){return $(this).attr("src").replace("theme-path",courseData.THEME_PATH)}),$(".add-theme-path-head").attr("href",function(){return $(this).attr("href").replace("theme-path",courseData.THEME_PATH)})}function loadContentStyles(){var courseData=JSON.parse(localStorage.getItem(window.parent.LOCAL_COURSE_DATA_ID));$(".add-theme-path").attr("src",function(){return $(this).attr("src").replace("theme-path",courseData.THEME_PATH)}),$(".add-theme-path-head").attr("href",function(){return $(this).attr("href").replace("theme-path",courseData.THEME_PATH)})}var TRACKING="SCORM",SCORM="1.2",setScore=-1,mtmOpened=!1;function SetBookmark(c,p){if("SCORM"==TRACKING){if(null==getAPIHandle())return;"2004"==SCORM?doLMSSetValue("cmi.location",c+"_"+p):"1.2"==SCORM&&doLMSSetValue("cmi.core.lesson_location",c+"_"+p),doLMSCommit()}else"COOKIES"==TRACKING&&setCookie(cookieName+"bm",c+"_"+p)}function GetBookmark(){if("SCORM"==TRACKING){if(null==getAPIHandle())return;if("2004"==SCORM)return doLMSGetValue("cmi.location");if("1.2"==SCORM)return doLMSGetValue("cmi.core.lesson_location")}else if("COOKIES"==TRACKING)return GetCookie(cookieName+"bm")}function CreatePathmarks(){for(var s="",i=0;i<courseData.chapters.length;i++){var active=0;"true"==courseData.chapters[i].isActive&&(active=1),s=s+active+"]"+courseData.chapters[i].titleIndex+"}";for(var j=0;j<courseData.chapters[i].pages.length;j++)j==courseData.chapters[i].pages.length-1?s+=courseData.chapters[i].pages[j].locks.toString():s=s+courseData.chapters[i].pages[j].locks.toString()+";";i<courseData.chapters.length-1&&(s+=":")}if("SCORM"==TRACKING){if(null==getAPIHandle())return;doLMSSetValue("cmi.suspend_data",s),doLMSCommit()}else"COOKIES"==TRACKING&&setCookie(cookieName+"pm",s);var isComplete=!0,noActive=!0;for(i=1;i<courseData.chapters.length;i++)for(j=0;j<courseData.chapters[i].pages.length;j++)if("true"==courseData.chapters[i].isActive&&(noActive=!1),-1!=courseData.chapters[i].pages[j].locks.toString().indexOf("0")&&"true"==courseData.chapters[i].isActive){isComplete=!1;break}("page_view"==courseData.COMPLETION_METHOD&&isComplete&&!noActive||"immediate"==courseData.COMPLETION_METHOD)&&SetComplete()}function GetPathmark(){if("SCORM"==TRACKING){if(null==getAPIHandle())return;return doLMSGetValue("cmi.suspend_data")}return"COOKIES"==TRACKING?GetCookie(cookieName+"pm"):""}function SetComplete(){if("SCORM"==TRACKING){if(null==getAPIHandle())return;"1.2"==SCORM?doLMSSetValue("cmi.core.lesson_status","passed"):"2004"==SCORM&&(doLMSSetValue("cmi.completion_status","completed"),doLMSSetValue("cmi.success_status","passed"),-1!=setScore&&(doLMSSetValue("cmi.score.raw",setScore),doLMSSetValue("cmi.score.scaled",setScore/100))),doLMSCommit()}}function SendScore(percent,REQUIRED_PERCENT){if(REQUIRED_PERCENT<=percent&&openLock(currentChapter,currentPage,1),"SCORM"==TRACKING){if(null==getAPIHandle())return;"1.2"==SCORM?(doLMSSetValue("cmi.core.score.raw",percent),REQUIRED_PERCENT<=percent&&doLMSSetValue("cmi.core.lesson_status","passed")):"2004"==SCORM&&(doLMSSetValue("cmi.score.raw",percent),doLMSSetValue("cmi.score.scaled",percent/100),REQUIRED_PERCENT<=(setScore=percent)&&"assessment"==courseData.COMPLETION_METHOD&&(doLMSSetValue("cmi.completion_status","completed"),doLMSSetValue("cmi.success_status","passed"))),doLMSCommit()}}function setInteraction(id,correctResponse,learnerResponse,result,description,type){"SCORM"==TRACKING&&"2004"==SCORM&&(doLMSSetValue("cmi.interactions."+id+".id",id),doLMSSetValue("cmi.interactions."+id+".type",type),doLMSSetValue("cmi.interactions."+id+".timestamp",ISODateString(new Date)),doLMSSetValue("cmi.interactions."+id+".correct_responses.0.pattern",correctResponse),doLMSSetValue("cmi.interactions."+id+".learner_response",learnerResponse),doLMSSetValue("cmi.interactions."+id+".result",result),250<description.length&&(description=description.substr(0,249)),doLMSSetValue("cmi.interactions."+id+".description",description),doLMSCommit())}function ISODateString(d){function pad(n){return n<10?"0"+n:n}return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())}function StartLMS(){try{if(null==getAPIHandle())return void(TRACKING="COOKIES");if(doLMSInitialize(),startTimer(),"2004"==SCORM)"incomplete"!=(status=doLMSGetValue("cmi.completion_status"))&&"completed"!=status&&(doLMSSetValue("cmi.completion_status","incomplete"),doLMSSetValue("cmi.success_status","unknown"),doLMSSetValue("cmi.location",""),doLMSSetValue("cmi.suspend_data","")),doLMSSetValue("cmi.exit","suspend"),doLMSCommit();else if("1.2"==SCORM){var status;"not attempted"==(status=doLMSGetValue("cmi.core.lesson_status"))&&(doLMSSetValue("cmi.core.lesson_status","incomplete"),doLMSSetValue("cmi.core.lesson_location",""),doLMSSetValue("cmi.suspend_data",""),doLMSSetValue("cmi.core.exit","suspend"),doLMSCommit())}}catch(e){TRACKING="COOKIES"}}function QuitLMS(){"SCORM"==TRACKING&&("2004"==SCORM?doLMSSetValue("cmi.exit","suspend"):"1.2"==SCORM&&doLMSSetValue("cmi.core.exit","suspend"),computeTime(),doLMSFinish())}function GetCookie(cookieName){if(search=cookieName+"=",0<document.cookie.length)return offset=document.cookie.indexOf(search),-1!=offset?(offset+=search.length,end=document.cookie.indexOf(";",offset),-1==end&&(end=document.cookie.length),cookieValue=unescape(document.cookie.substring(offset,end)),cookieValue):""}function setCookie(cookieName,cookieValue,cookieLife){expirationDate=new Date,null==cookieLife||-1!=cookieLife?(cookieLife=31536e6,expirationDate.setTime(expirationDate.getTime()+cookieLife),document.cookie=escape(cookieName)+"="+escape(cookieValue)+";expires="+expirationDate.toGMTString()+";path=/"):document.cookie=escape(cookieName)+"="+escape(cookieValue)+";path=/"}function registerPageVisit(courseDataId,pageId){var courseData=JSON.parse(localStorage.getItem(courseDataId));-1==courseData.pageCount.pageIds.indexOf(pageId)&&(courseData.pageCount.pageIds.push(pageId),courseData.pageCount.pagesVisited++),localStorage.setItem(courseDataId,JSON.stringify(courseData))}